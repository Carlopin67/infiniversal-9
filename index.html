<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#0e0e14" />
  <meta name="description" content="Bloc de notas creativo para poetas y compositores" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Infiniversal" />
  <meta name="mobile-web-app-capable" content="yes" />
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icon-192.png" />
  <link rel="stylesheet" href="style.css" />
  <title>Infiniversal</title>
</head>
<body class="theme-dark">

  <!-- ══════════════════════════════════════
       TUTORIAL — primera ejecución
  ══════════════════════════════════════ -->
  <div id="tutorial-overlay" class="overlay hidden">
    <div class="tutorial-card">
      <div class="tutorial-steps">
        <div class="tutorial-step active" data-step="1">
          <div class="tutorial-icon">✦</div>
          <h2>Bienvenido a<br><span class="brand-name">Infiniversal</span></h2>
          <p>Tu espacio creativo para poesía y letras de canciones. Offline, elegante y siempre contigo.</p>
        </div>
        <div class="tutorial-step" data-step="2">
          <div class="tutorial-icon">◈</div>
          <h2>Crea y organiza</h2>
          <p>Escribe poemas con estructura guiada o compón canciones con secciones marcadas.</p>
        </div>
        <div class="tutorial-step" data-step="3">
          <div class="tutorial-icon">◉</div>
          <h2>Herramientas para escritores</h2>
          <p>Contador de sílabas siempre activo, deshacer/rehacer, zoom de texto y tema claro/oscuro.</p>
        </div>
        <div class="tutorial-step" data-step="4">
          <div class="tutorial-icon">⬡</div>
          <h2>Todo offline</h2>
          <p>Tus notas se guardan localmente. Sin internet. Sin límites. Solo tú y tus palabras.</p>
        </div>
      </div>
      <div class="tutorial-dots">
        <span class="dot active" data-dot="1"></span>
        <span class="dot" data-dot="2"></span>
        <span class="dot" data-dot="3"></span>
        <span class="dot" data-dot="4"></span>
      </div>
      <div class="tutorial-actions">
        <button id="tutorial-prev" class="btn-ghost hidden">Anterior</button>
        <button id="tutorial-next" class="btn-primary">Siguiente</button>
        <button id="tutorial-skip" class="btn-link">Saltar</button>
      </div>
    </div>
  </div>

  <!-- ══════════════════════════════════════
       MODAL: TIPO DE NOTA
  ══════════════════════════════════════ -->
  <div id="type-modal" class="overlay hidden">
    <div class="modal-card">
      <h2>Nueva nota</h2>
      <p class="modal-subtitle">¿Qué vas a crear hoy?</p>
      <div class="type-grid">
        <button class="type-btn" data-type="poem">
          <span class="type-icon">◎</span>
          <span class="type-label">Poesía</span>
          <span class="type-desc">Sonetos, cuartetos, liras...</span>
        </button>
        <button class="type-btn" data-type="song">
          <span class="type-icon">♩</span>
          <span class="type-label">Canción</span>
          <span class="type-desc">Verso, estribillo, puente...</span>
        </button>
      </div>
      <button id="type-cancel" class="btn-link">Cancelar</button>
    </div>
  </div>

  <!-- ══════════════════════════════════════
       MODAL: ESTRUCTURA POÉTICA
  ══════════════════════════════════════ -->
  <div id="poem-structure-modal" class="overlay hidden">
    <div class="modal-card poem-struct-card">
      <div class="poem-struct-header">
        <button id="poem-structure-back" class="btn-icon" aria-label="Volver">←</button>
        <div class="poem-struct-title-block">
          <h2>Elige tu forma</h2>
          <p>Cada estructura tiene su propia música interior</p>
        </div>
      </div>
      <div id="struct-preview" class="struct-preview">
        <div class="struct-preview-name" id="preview-name">Soneto</div>
        <div class="struct-preview-visual" id="preview-visual"></div>
        <div class="struct-preview-meta" id="preview-meta"></div>
        <div class="struct-preview-desc" id="preview-desc"></div>
      </div>
      <div class="struct-grid">
        <button class="struct-card active" data-structure="soneto">
          <span class="struct-card-symbol">XIV</span>
          <span class="struct-card-name">Soneto</span>
          <span class="struct-card-tag">Clásico</span>
        </button>
        <button class="struct-card" data-structure="cuarteto">
          <span class="struct-card-symbol">IV</span>
          <span class="struct-card-name">Cuarteto</span>
          <span class="struct-card-tag">ABBA</span>
        </button>
        <button class="struct-card" data-structure="terceto">
          <span class="struct-card-symbol">III</span>
          <span class="struct-card-name">Terceto</span>
          <span class="struct-card-tag">ABA</span>
        </button>
        <button class="struct-card" data-structure="lira">
          <span class="struct-card-symbol">V</span>
          <span class="struct-card-name">Lira</span>
          <span class="struct-card-tag">7-11-7</span>
        </button>
        <button class="struct-card" data-structure="haiku">
          <span class="struct-card-symbol">俳</span>
          <span class="struct-card-name">Haiku</span>
          <span class="struct-card-tag">5·7·5</span>
        </button>
        <button class="struct-card" data-structure="silva">
          <span class="struct-card-symbol">∿</span>
          <span class="struct-card-name">Silva</span>
          <span class="struct-card-tag">Libre</span>
        </button>
        <button class="struct-card" data-structure="decima">
          <span class="struct-card-symbol">X</span>
          <span class="struct-card-name">Décima</span>
          <span class="struct-card-tag">Espinela</span>
        </button>
        <button class="struct-card" data-structure="oda">
          <span class="struct-card-symbol">♩</span>
          <span class="struct-card-name">Oda</span>
          <span class="struct-card-tag">Lírica</span>
        </button>
        <button class="struct-card struct-card-free" data-structure="libre">
          <span class="struct-card-symbol">∞</span>
          <span class="struct-card-name">Verso libre</span>
          <span class="struct-card-tag">Sin límites</span>
        </button>
      </div>
      <button id="struct-create-btn" class="btn-struct-create">
        Crear poema <span id="struct-create-name">Soneto</span> →
      </button>
    </div>
  </div>

  <!-- ══════════════════════════════════════
       MODAL: AJUSTES
  ══════════════════════════════════════ -->
  <div id="settings-modal" class="overlay hidden">
    <div class="modal-card settings-card">
      <div class="modal-header">
        <h2>Ajustes</h2>
        <button id="settings-close" class="btn-icon-close">✕</button>
      </div>
      <div class="settings-section">
        <h3>Apariencia</h3>
        <div class="setting-row">
          <label>Tema</label>
          <div class="theme-toggle-group">
            <button class="theme-opt active" data-theme="dark">Oscuro</button>
            <button class="theme-opt" data-theme="light">Claro</button>
          </div>
        </div>
        <div class="setting-row">
          <label>Tamaño de texto</label>
          <div class="zoom-controls">
            <button id="zoom-out" class="btn-icon">−</button>
            <span id="zoom-label">100%</span>
            <button id="zoom-in" class="btn-icon">+</button>
          </div>
        </div>
      </div>
      <div class="settings-section">
        <h3>Editor</h3>
        <div class="setting-row">
          <label>Formato de texto (negrita, cursiva...)</label>
          <label class="toggle-switch">
            <input type="checkbox" id="toggle-rich" />
            <span class="slider"></span>
          </label>
        </div>
        <div class="setting-row">
          <label>Herramientas de métrica y ritmo</label>
          <label class="toggle-switch">
            <input type="checkbox" id="toggle-metric" />
            <span class="slider"></span>
          </label>
        </div>
      </div>
    </div>
  </div>

  <!-- ══════════════════════════════════════
       MODAL: AYUDA
  ══════════════════════════════════════ -->
  <div id="help-modal" class="overlay hidden">
    <div class="modal-card help-card">
      <div class="modal-header">
        <h2>Ayuda</h2>
        <button id="help-close" class="btn-icon-close">✕</button>
      </div>
      <div class="help-content">
        <div class="help-section">
          <h4>✦ Crear una nota</h4>
          <p>Pulsa el botón + para crear una nueva nota. Elige entre Poesía (con estructura guiada) o Canción (con secciones marcadas).</p>
        </div>
        <div class="help-section">
          <h4>◈ Tags</h4>
          <p>Añade tags a tus notas para organizarlas. Puedes filtrar por tag desde la pantalla principal.</p>
        </div>
        <div class="help-section">
          <h4>★ Favoritas</h4>
          <p>Marca tus notas favoritas con la estrella para encontrarlas rápido en el filtro "Favoritas".</p>
        </div>
        <div class="help-section">
          <h4>↗ Compartir</h4>
          <p>Comparte o descarga tu nota como TXT o PDF desde el editor.</p>
        </div>
        <div class="help-section">
          <h4>⊠ Eliminar</h4>
          <p>Pulsa el botón eliminar dentro de la nota. Se pedirá confirmación antes de borrar.</p>
        </div>
        <div class="help-section">
          <h4>☰ Selección múltiple</h4>
          <p>Mantén pulsada una nota para activar la selección múltiple. Luego puedes eliminar o compartir varias a la vez.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- ══════════════════════════════════════
       MODAL: COMPARTIR
  ══════════════════════════════════════ -->
  <div id="share-modal" class="overlay hidden">
    <div class="modal-card share-card">
      <div class="modal-header">
        <h2>Compartir nota</h2>
        <button id="share-close" class="btn-icon-close">✕</button>
      </div>
      <div class="share-actions">
        <button id="share-clipboard" class="share-btn">
          <span class="share-btn-icon">⊕</span> Copiar al portapapeles
        </button>
        <button id="share-txt" class="share-btn">
          <span class="share-btn-icon">↓</span> Descargar como TXT
        </button>
        <button id="share-pdf" class="share-btn">
          <span class="share-btn-icon">◻</span> Imprimir / PDF
        </button>
      </div>
      <div id="share-toast" class="share-toast hidden">Copiado al portapapeles</div>
    </div>
  </div>

  <!-- ══════════════════════════════════════
       MODAL: TAGS
  ══════════════════════════════════════ -->
  <div id="tag-modal" class="overlay hidden">
    <div class="modal-card">
      <div class="modal-header">
        <h2>Gestionar tags</h2>
        <button id="tag-close" class="btn-icon-close">✕</button>
      </div>
      <div class="tag-input-row">
        <input type="text" id="tag-input" placeholder="Nuevo tag..." class="text-input" />
        <button id="tag-add" class="btn-primary small">Añadir</button>
      </div>
      <div id="tag-list" class="tag-list"></div>
    </div>
  </div>

  <!-- ══════════════════════════════════════
       MODAL: CONFIRMAR ELIMINACIÓN MÚLTIPLE
  ══════════════════════════════════════ -->
  <div id="bulk-delete-modal" class="overlay hidden">
    <div class="modal-card delete-card">
      <div class="delete-icon">⊠</div>
      <h2>Eliminar notas</h2>
      <p class="modal-subtitle" id="bulk-delete-subtitle">Esta acción no se puede deshacer.</p>
      <div class="delete-actions">
        <button id="bulk-delete-confirm" class="btn-danger">Sí, eliminar</button>
        <button id="bulk-delete-cancel" class="btn-ghost">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- ══════════════════════════════════════
       MODAL: COMPARTIR MÚLTIPLE
  ══════════════════════════════════════ -->
  <div id="bulk-share-modal" class="overlay hidden">
    <div class="modal-card share-card">
      <div class="modal-header">
        <h2>Compartir notas</h2>
        <button id="bulk-share-close" class="btn-icon-close">✕</button>
      </div>
      <p class="modal-subtitle" id="bulk-share-subtitle">Compartir notas seleccionadas</p>
      <div class="share-actions">
        <button id="bulk-share-clipboard" class="share-btn">
          <span class="share-btn-icon">⊕</span> Copiar todas al portapapeles
        </button>
        <button id="bulk-share-txt" class="share-btn">
          <span class="share-btn-icon">↓</span> Descargar como TXT
        </button>
      </div>
      <div id="bulk-share-toast" class="share-toast hidden">Copiado al portapapeles</div>
    </div>
  </div>

  <!-- ══════════════════════════════════════
       MODAL: CONFIRMAR ELIMINACIÓN
  ══════════════════════════════════════ -->
  <div id="delete-modal" class="overlay hidden">
    <div class="modal-card delete-card">
      <div class="delete-icon">⊠</div>
      <h2>Eliminar nota</h2>
      <p class="modal-subtitle">Esta acción no se puede deshacer. ¿Seguro?</p>
      <div class="delete-actions">
        <button id="delete-confirm" class="btn-danger">Sí, eliminar</button>
        <button id="delete-cancel" class="btn-ghost">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- ══════════════════════════════════════
       APP PRINCIPAL
  ══════════════════════════════════════ -->
  <div id="app">

    <!-- VISTA: LISTA DE NOTAS -->
    <div id="view-list" class="view">
      <header class="app-header">
        <div class="header-brand">
          <span class="brand-symbol">∞</span>
          <h1>Infiniversal</h1>
        </div>
        <div class="header-actions">
          <button id="btn-help" class="btn-icon" aria-label="Ayuda">?</button>
          <button id="btn-settings" class="btn-icon" aria-label="Ajustes">⚙</button>
        </div>
      </header>

      <div class="filter-bar">
        <button class="filter-btn active" data-filter="all">Todas</button>
        <button class="filter-btn" data-filter="poem">Poesía</button>
        <button class="filter-btn" data-filter="song">Canciones</button>
        <button class="filter-btn" data-filter="fav">Favoritas</button>
        <button class="filter-btn" data-filter="tags" id="filter-tags-btn">Tags ▾</button>
      </div>

      <div id="active-tags-bar" class="active-tags-bar hidden"></div>

      <main id="notes-list" class="notes-list">
        <div class="empty-state" id="empty-state">
          <div class="empty-symbol">✦</div>
          <p>Tu lienzo está vacío.<br>Crea tu primera nota.</p>
        </div>
      </main>
      <div id="select-hint" class="select-hint"></div>

      <button id="btn-new" class="fab" aria-label="Nueva nota">+</button>

      <!-- Barra de selección múltiple -->
      <div id="select-bar" class="select-bar hidden">
        <div class="select-bar-info">
          <button id="select-cancel" class="btn-icon select-cancel-btn" aria-label="Cancelar">✕</button>
          <span id="select-count">0 seleccionadas</span>
        </div>
        <div class="select-bar-actions">
          <button id="select-share" class="select-action-btn">
            <span class="select-action-icon">↗</span>
            <span>Compartir</span>
          </button>
          <button id="select-delete" class="select-action-btn select-action-danger">
            <span class="select-action-icon">⊠</span>
            <span>Eliminar</span>
          </button>
        </div>
      </div>
    </div>

    <!-- VISTA: EDITOR -->
    <div id="view-editor" class="view hidden">
      <header class="editor-header">
        <button id="btn-back" class="btn-icon" aria-label="Volver">←</button>
        <div class="editor-header-center">
          <span id="editor-type-badge" class="type-badge"></span>
        </div>
        <div class="editor-header-actions">
          <button id="btn-fav"    class="btn-icon" aria-label="Favorito">☆</button>
          <button id="btn-tags"   class="btn-icon" aria-label="Tags">◈</button>
          <button id="btn-share"  class="btn-icon" aria-label="Compartir">↗</button>
          <button id="btn-delete" class="btn-icon btn-icon-danger" aria-label="Eliminar">⊠</button>
        </div>
      </header>

      <div id="song-toolbar" class="song-toolbar hidden">
        <button class="section-btn" data-section="Intro">Intro</button>
        <button class="section-btn" data-section="Verso">Verso</button>
        <button class="section-btn" data-section="Pre-estribillo">Pre-est.</button>
        <button class="section-btn" data-section="Estribillo">Estribillo</button>
        <button class="section-btn" data-section="Puente">Puente</button>
        <button class="section-btn" data-section="Outro">Outro</button>
      </div>

      <div id="poem-guide" class="poem-guide hidden"></div>

      <div id="rich-toolbar" class="rich-toolbar hidden">
        <button class="fmt-btn" data-cmd="bold"><strong>N</strong></button>
        <button class="fmt-btn" data-cmd="italic"><em>K</em></button>
        <button class="fmt-btn" data-cmd="underline"><u>S</u></button>
        <button class="fmt-btn" data-cmd="undo">↩</button>
        <button class="fmt-btn" data-cmd="redo">↪</button>
      </div>

      <div id="metric-toolbar" class="metric-toolbar hidden">
        <span class="metric-label">Métrica:</span>
        <span id="metric-syllables" class="metric-value">— síl.</span>
        <span class="metric-sep">·</span>
        <span class="metric-label">Verso:</span>
        <span id="metric-type" class="metric-value">—</span>
      </div>

      <input type="text" id="note-title" class="note-title-input" placeholder="Título..." />
      <div id="note-tags-bar" class="note-tags-bar"></div>

      <div id="note-editor"
           class="note-editor"
           contenteditable="true"
           spellcheck="true"
           aria-multiline="true"
           aria-label="Editor de nota"
           data-placeholder="Comienza a escribir..."></div>

      <div class="editor-stats">
        <span id="stat-words">0 palabras</span>
        <span class="stat-sep">·</span>
        <span id="stat-syllables">0 síl.</span>
        <span class="stat-sep">·</span>
        <span id="stat-chars">0 car.</span>
      </div>

      <div id="plain-undo-bar" class="plain-undo-bar">
        <button id="btn-undo" class="btn-ghost small">↩ Deshacer</button>
        <button id="btn-redo" class="btn-ghost small">↪ Rehacer</button>
      </div>
    </div>

  </div><!-- /#app -->

  <script src="app.js"></script>
</body>
</html>
